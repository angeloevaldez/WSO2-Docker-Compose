<?xml version="1.0" encoding="UTF-8"?>
<proxy name="HCCProxyService" startOnLoad="true" trace="disable"
  transports="http https" xmlns="http://ws.apache.org/ns/synapse">
  <target>
    <inSequence>
      <property description="extract longitude"
        expression="//heal:getHealthcareCenterInfo/heal:longitude/text()"
        name="longitude" scope="default" type="STRING" xmlns:heal="http://healthcare.wso2/"/>
      <property description="extract latitude"
        expression="//heal:getHealthcareCenterInfo/heal:latitude/text()"
        name="latitude" scope="default" type="STRING" xmlns:heal="http://healthcare.wso2"/>
      <log description="debug">
        <property expression="$ctx:longitude" name="longitude"/>
        <property expression="$ctx:latitude" name="latitude"/>
      </log>
      <enrich description="construct message">
        <source clone="true" type="inline">
          <geo:getZipCode xmlns:geo="http://geo.wso2">
            <geo:longitude>0</geo:longitude>
            <geo:latitude>0</geo:latitude>
          </geo:getZipCode>
        </source>
        <target type="body"/>
      </enrich>
      <enrich description="set latitude">
        <source clone="true" property="latititude" type="property"/>
        <target xpath="//geo:getZipCode/geo:latitude/text()"/>
      </enrich>
      <enrich description="set longitude">
        <source clone="true" property="longitude" type="property"/>
        <target xpath="//geo:getZipCode/geo:longitude/text()"/>
      </enrich>
      <log description="request debug">
        <property expression="$ctx:latitude" name="latitude"/>
        <property expression="$ctx:longitude" name="longitude"/>
      </log>
      <send receive="hcfRequest"/>
    </inSequence>
    <outSequence>
      <log level="full"/>
      <aggregate>
        <completeCondition>
          <messageCount max="-1" min="-1"/>
        </completeCondition>
        <onComplete expression="//hcc:getHCCenterInfoResponse" xmlns:hcc="http://healthcare.wso2">
          <log level="full"/>
        </onComplete>
      </aggregate>
    </outSequence>
    <faultSequence/>
  </target>
</proxy>
